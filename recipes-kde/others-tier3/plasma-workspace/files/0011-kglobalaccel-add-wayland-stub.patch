From 2e42d537e1f783098da35ae2c93bdd6a6c8fe4c8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Tue, 16 Dec 2014 23:22:47 +0100
Subject: [PATCH 11/11] kglobalaccel: add wayland stub
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Andreas Müller <schnitzeltony@googlemail.com>
---
 kglobalaccel/CMakeLists.txt           |  3 ++
 kglobalaccel/kglobalaccel_wayland.cpp | 50 ++++++++++++++++++++++++++++
 kglobalaccel/kglobalaccel_wayland.h   | 62 +++++++++++++++++++++++++++++++++++
 3 files changed, 115 insertions(+)
 create mode 100644 kglobalaccel/kglobalaccel_wayland.cpp
 create mode 100644 kglobalaccel/kglobalaccel_wayland.h

diff --git a/kglobalaccel/CMakeLists.txt b/kglobalaccel/CMakeLists.txt
index bdeedaf..5315b2c 100644
--- a/kglobalaccel/CMakeLists.txt
+++ b/kglobalaccel/CMakeLists.txt
@@ -27,6 +27,9 @@ endif ()
 if ( Q_WS_QWS )
   set( kglobalaccel_SRCS ${kglobalaccel_SRCS} kglobalaccel_qws.cpp )
 endif ()
+if ( KF5Wayland_FOUND )
+  set( kglobalaccel_SRCS ${kglobalaccel_SRCS} kglobalaccel_wayland.cpp )
+endif ()
 
 configure_file(config-kglobalaccel.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config-kglobalaccel.h )
 
diff --git a/kglobalaccel/kglobalaccel_wayland.cpp b/kglobalaccel/kglobalaccel_wayland.cpp
new file mode 100644
index 0000000..fb95952
--- /dev/null
+++ b/kglobalaccel/kglobalaccel_wayland.cpp
@@ -0,0 +1,50 @@
+/* This file is part of the KDE libraries
+    Copyright (C) 2014 Andreas Müller <schnitzeltony@googlemail.com>
+
+    This library is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Library General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+
+#include "kglobalaccel_wayland.h"
+
+#include "globalshortcutsregistry.h"
+#include "kkeyserver.h"
+#include <netwm.h>
+
+#include <QDebug>
+
+#include <QApplication>
+#include <QWidget>
+
+
+KGlobalAccelImpl::KGlobalAccelImpl(GlobalShortcutsRegistry *owner)
+    : QObject(owner)
+{
+}
+
+KGlobalAccelImpl::~KGlobalAccelImpl()
+{
+}
+
+bool KGlobalAccelImpl::grabKey( int keyQt, bool grab )
+{
+	return false;
+}
+
+void KGlobalAccelImpl::setEnabled( bool enable )
+{
+}
+
+#include "kglobalaccel_wayland.moc"
diff --git a/kglobalaccel/kglobalaccel_wayland.h b/kglobalaccel/kglobalaccel_wayland.h
new file mode 100644
index 0000000..d686ae3
--- /dev/null
+++ b/kglobalaccel/kglobalaccel_wayland.h
@@ -0,0 +1,62 @@
+/* This file is part of the KDE libraries
+    Copyright (C) 2014 Andreas Müller <schnitzeltony@googlemail.com>
+
+    This library is free software; you can redistribute it and/or
+    modify it under the terms of the GNU Library General Public
+    License as published by the Free Software Foundation; either
+    version 2 of the License, or (at your option) any later version.
+
+    This library is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public License
+    along with this library; see the file COPYING.LIB.  If not, write to
+    the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
+    Boston, MA 02110-1301, USA.
+*/
+
+#ifndef _KGLOBALACCEL_WAYLAND_H
+#define _KGLOBALACCEL_WAYLAND_H
+
+#include <QObject>
+
+class GlobalShortcutsRegistry;
+/**
+ * @internal
+ *
+ * The KGlobalAccel private class handles grabbing of global keys,
+ * and notification of when these keys are pressed.
+ */
+class KGlobalAccelImpl : public QObject
+{
+	Q_OBJECT
+
+public:
+    KGlobalAccelImpl( GlobalShortcutsRegistry *owner);
+    virtual ~KGlobalAccelImpl();
+
+public:
+	/**
+	 * This function registers or unregisters a certain key for global capture,
+	 * depending on \b grab.
+	 *
+	 * Before destruction, every grabbed key will be released, so this
+	 * object does not need to do any tracking.
+	 *
+	 * \param key the Qt keycode to grab or release.
+	 * \param grab true to grab they key, false to release the key.
+	 *
+	 * \return true if successful, otherwise false.
+	 */
+	bool grabKey(int key, bool grab);
+	
+	/// Enable/disable all shortcuts. There will not be any grabbed shortcuts at this point.
+	void setEnabled(bool);
+
+private:
+
+};
+
+#endif // _KGLOBALACCEL_WAYLAND_H
-- 
1.8.3.1

