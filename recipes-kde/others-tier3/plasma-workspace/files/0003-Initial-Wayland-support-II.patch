From d811d01b610432c3ae6480883f01b7367254e2db Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Thu, 11 Dec 2014 13:54:24 +0100
Subject: [PATCH 03/11] Initial Wayland support II
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Remove traces on ksmserver. This is necccessary for pure wayland environments.

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 libkworkspace/CMakeLists.txt | 6 ++++--
 libkworkspace/kworkspace.cpp | 2 ++
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/libkworkspace/CMakeLists.txt b/libkworkspace/CMakeLists.txt
index 53ce610..b7a5348 100644
--- a/libkworkspace/CMakeLists.txt
+++ b/libkworkspace/CMakeLists.txt
@@ -10,13 +10,15 @@ remove_definitions(-DQT_NO_CAST_TO_ASCII)
 
 
 set(ksmserver_xml  ${plasma-workspace_SOURCE_DIR}/ksmserver/org.kde.KSMServerInterface.xml)
-qt5_add_dbus_interface( kworkspace_LIB_SRCS ${ksmserver_xml} ksmserver_interface )
+
+if(HAVE_X11)
+    qt5_add_dbus_interface( kworkspace_LIB_SRCS ${ksmserver_xml} ksmserver_interface )
+endif()
 
 set_source_files_properties(${KWIN_INTERFACE} PROPERTIES INCLUDE "interface_util.h")
 
 qt5_add_dbus_interface( kworkspace_LIB_SRCS ${KWIN_INTERFACE} kwin_interface )
 
-
 add_library(kworkspace ${kworkspace_LIB_SRCS})
 add_library(PW::KWorkspace ALIAS kworkspace)
 set_target_properties(kworkspace PROPERTIES
diff --git a/libkworkspace/kworkspace.cpp b/libkworkspace/kworkspace.cpp
index bad054a..ba3e284 100644
--- a/libkworkspace/kworkspace.cpp
+++ b/libkworkspace/kworkspace.cpp
@@ -28,7 +28,9 @@
 #include <QDateTime>
 #include <QtDBus/QtDBus>
 #include <stdlib.h> // getenv()
+#if HAVE_X11
 #include <ksmserver_interface.h>
+#endif
 #include <QSocketNotifier>
 
 #if HAVE_X11
-- 
1.8.3.1

