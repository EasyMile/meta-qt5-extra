From aa93d50c49cefa8780dce38cc7f7cc7d406b89ee Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Thu, 29 Jan 2015 23:32:04 +0100
Subject: [PATCH] native: build and install katehighlightingindexer only
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Upstream-Status: Inappropriate [embedded-specific]

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 CMakeLists.txt                 | 6 +++++-
 src/CMakeLists.txt             | 4 ++++
 src/syntax/data/CMakeLists.txt | 8 +++++++-
 3 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7dda78b..5c7b82c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -32,8 +32,9 @@ ecm_setup_version(
 set(REQUIRED_QT_VERSION "5.2.0")
 
 # Required Qt5 components to build this framework
-find_package(Qt5 ${REQUIRED_QT_VERSION} NO_MODULE REQUIRED Core Widgets Script PrintSupport Xml XmlPatterns)
+find_package(Qt5 ${REQUIRED_QT_VERSION} NO_MODULE REQUIRED Core Xml XmlPatterns)
 
+if(False)
 find_package(KF5Archive ${KF5_DEP_VERSION} REQUIRED)
 find_package(KF5Config ${KF5_DEP_VERSION} REQUIRED)
 find_package(KF5GuiAddons ${KF5_DEP_VERSION} REQUIRED)
@@ -50,7 +51,9 @@ add_definitions(-DTRANSLATION_DOMAIN=\"ktexteditor5\")
 if (IS_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/po")
     ki18n_install(po)
 endif()
+endif()
 add_subdirectory(src)
+if(False)
 if (BUILD_TESTING)
     add_subdirectory(autotests)
 endif()
@@ -90,5 +93,6 @@ configure_file (config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config.h)
 
 # let our config.h be found first in any case
 include_directories (BEFORE ${CMAKE_CURRENT_BINARY_DIR})
+endif()
 
 feature_summary(WHAT ALL FATAL_ON_MISSING_REQUIRED_PACKAGES)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 18c49c5..d9ce2db 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,3 +1,4 @@
+if(False)
 # libgit2 integration
 find_package(LibGit2 "0.22.0")
 if(LIBGIT2_FOUND)
@@ -314,12 +315,15 @@ install(FILES ${PRI_FILENAME} DESTINATION ${ECM_MKSPECS_INSTALL_DIR})
 
 # handle data files, .desktop & .cmake
 add_subdirectory(data)
+endif()
 
 # syntax highlighting data files
 add_subdirectory( syntax/data )
 
+if(False)
 # jscripts for the part
 add_subdirectory( script/data )
 
 # add part
 add_subdirectory(part)
+endif()
diff --git a/src/syntax/data/CMakeLists.txt b/src/syntax/data/CMakeLists.txt
index 481fbf2..950234b 100644
--- a/src/syntax/data/CMakeLists.txt
+++ b/src/syntax/data/CMakeLists.txt
@@ -1,5 +1,6 @@
 ########### install files ###############
 
+if(False)
 find_package(Perl REQUIRED)
 
 add_custom_target(GeneratePhpXmlFiles ALL DEPENDS
@@ -16,9 +17,10 @@ endmacro(GENERATE_PHP_XML)
 generate_php_xml(javascript-php.xml javascript.xml)
 generate_php_xml(css-php.xml css.xml)
 generate_php_xml(html-php.xml html.xml)
+endif()
 
 # allow to disable the compilation + install for update xml generation
-if (NOT ONLY_GENERATE_XML)
+if (False)
 
 # all hls
 file(GLOB HIGHLIGHTERS "${CMAKE_CURRENT_SOURCE_DIR}/*.xml")
@@ -40,11 +42,15 @@ file(REMOVE ${INDEXFILE_IN})
 foreach(highlighter ${ALL_HIGHLIGHTERS})
     file(APPEND ${INDEXFILE_IN} "${highlighter}\n")
 endforeach()
+endif()
 
 # tool to create json index of highlightings, will validate all highlightings, too!
 add_executable(katehighlightingindexer katehighlightingindexer.cpp)
 target_link_libraries(katehighlightingindexer Qt5::XmlPatterns
 )
+install(TARGETS katehighlightingindexer EXPORT KF5TextEditorTargets ${KF5_INSTALL_TARGETS_DEFAULT_ARGS})
+
+if(False)
 add_custom_command(OUTPUT ${INDEXFILE_OUT}
   COMMAND katehighlightingindexer ${INDEXFILE_OUT} ${LANGUAGE_XSD} ${INDEXFILE_IN}
   DEPENDS katehighlightingindexer.cpp ${LANGUAGE_XSD} ${ALL_HIGHLIGHTERS} ${INDEXFILE_IN})
-- 
1.8.3.1
