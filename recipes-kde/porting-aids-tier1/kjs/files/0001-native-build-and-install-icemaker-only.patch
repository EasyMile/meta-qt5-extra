From f01929e72c1a5baadf974a5b3f816ad73dd1d35f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Thu, 29 Jan 2015 21:05:23 +0100
Subject: [PATCH] native: build and install icemaker only
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Upstream-Status: Inappropriate [embedded-specific]

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 CMakeLists.txt         | 2 --
 src/CMakeLists.txt     | 2 +-
 src/kjs/CMakeLists.txt | 4 +++-
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7610111..6c4fa70 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -46,8 +46,6 @@ option(KJS_FORCE_DISABLE_PCRE "Force building of KJS without PCRE. Doing this wi
 remove_definitions(-DQT_NO_CAST_FROM_ASCII)
 
 add_subdirectory(src)
-add_subdirectory(autotests)
-add_subdirectory(tests)
 
 # create a Config.cmake and a ConfigVersion.cmake file and install them
 set(CMAKECONFIG_INSTALL_DIR "${KDE_INSTALL_CMAKEPACKAGEDIR}/KF5JS")
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index de1d59f..c559f38 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,3 +1,3 @@
 add_subdirectory(kjs)
 
-add_subdirectory(wtf)
+
diff --git a/src/kjs/CMakeLists.txt b/src/kjs/CMakeLists.txt
index a51a71d..793779d 100644
--- a/src/kjs/CMakeLists.txt
+++ b/src/kjs/CMakeLists.txt
@@ -67,7 +67,8 @@ endif()
    add_executable(icemaker ${icemaker_SRCS})
    ecm_mark_nongui_executable(icemaker)
    target_include_directories(icemaker PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/..")
-
+   install(TARGETS icemaker EXPORT KF5JSTargets ${KF5_INSTALL_TARGETS_DEFAULT_ARGS})
+if(FALSE)
    # get the name of the generated wrapper script (which sets up LD_LIBRARY_PATH)
    #get_target_property(ICEMAKER_EXECUTABLE icemaker WRAPPER_SCRIPT)
    #get_target_property(ICEMAKER_EXECUTABLE_DIR icemaker RUNTIME_OUTPUT_DIRECTORY)
@@ -310,6 +311,7 @@ install(FILES
 )
 
 install(FILES create_hash_table DESTINATION ${KDE_INSTALL_DATADIR_KF5}/kjs/ )
+endif()
 
 include(ECMGeneratePriFile)
 ecm_generate_pri_file(BASE_NAME KJS LIB_NAME KF5JS DEPS "core" FILENAME_VAR PRI_FILENAME INCLUDE_INSTALL_DIR ${KDE_INSTALL_INCLUDEDIR_KF5}/KJS)
-- 
1.8.3.1

