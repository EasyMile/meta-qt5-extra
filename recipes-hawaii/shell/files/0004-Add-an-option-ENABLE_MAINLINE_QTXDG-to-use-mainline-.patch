From 13337d2f6216806d93a989f84af67c9052693122 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Fri, 30 Jan 2015 10:11:30 +0100
Subject: [PATCH 2/2] Add an option 'ENABLE_MAINLINE_QTXDG' to use mainline
 libqtxdg
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 3rdparty/CMakeLists.txt             | 4 +++-
 CMakeLists.txt                      | 6 ++++++
 declarative/launcher/CMakeLists.txt | 9 +++++++--
 session/CMakeLists.txt              | 7 ++++++-
 4 files changed, 22 insertions(+), 4 deletions(-)

diff --git a/3rdparty/CMakeLists.txt b/3rdparty/CMakeLists.txt
index a30bd32..8dc166f 100644
--- a/3rdparty/CMakeLists.txt
+++ b/3rdparty/CMakeLists.txt
@@ -1,3 +1,5 @@
-add_subdirectory(libqtxdg)
+if(NOT QTXDG_FOUND)
+    add_subdirectory(libqtxdg)
+endif()
 add_subdirectory(qlogind)
 add_subdirectory(sigwatch)
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 116c085..49959e7 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -12,6 +12,7 @@ set(CMAKE_AUTOMOC ON)
 option(ENABLE_SYSTEMD "Enables systemd support" OFF)
 option(ENABLE_ALSA "Enables Alsa mixer backend" ON)
 option(ENABLE_PULSEAUDIO "Enables PulseAudio mixer backend" ON)
+option(ENABLE_MAINLINE_QTXDG "Use mainline libqtxdg found at https://github.com/lxde/libqtxdg" OFF)
 
 # Set version
 set(HAWAII_VERSION_MAJOR 0)
@@ -84,6 +85,11 @@ find_package(KF5 ${KF5_MIN_VERSION} REQUIRED COMPONENTS
 # Find Green Island
 find_package(GreenIsland REQUIRED)
 
+# lxqt
+if(ENABLE_MAINLINE_QTXDG)
+    find_package(QT5XDG REQUIRED)
+endif()
+
 # Subdirectories
 add_subdirectory(3rdparty)
 add_subdirectory(compositor)
diff --git a/declarative/launcher/CMakeLists.txt b/declarative/launcher/CMakeLists.txt
index 7b69fdc..72ee80c 100644
--- a/declarative/launcher/CMakeLists.txt
+++ b/declarative/launcher/CMakeLists.txt
@@ -11,8 +11,13 @@ set(SOURCES
 add_library(launcherplugin SHARED ${SOURCES})
 target_link_libraries(launcherplugin
                       Qt5::Qml
-                      Qt5::Quick
-                      HawaiiQtXDG)
+                      Qt5::Quick)
+if(QTXDG_FOUND)
+    target_link_libraries(launcherplugin ${QTXDG_LIBRARIES})
+else()
+    target_link_libraries(launcherplugin HawaiiQtXDG)
+endif()
+
 
 install(FILES qmldir
     DESTINATION ${QML_INSTALL_DIR}/org/hawaii/launcher)
diff --git a/session/CMakeLists.txt b/session/CMakeLists.txt
index e0a8460..fb5058d 100644
--- a/session/CMakeLists.txt
+++ b/session/CMakeLists.txt
@@ -23,9 +23,14 @@ add_executable(hawaii-session ${SOURCES})
 target_link_libraries(hawaii-session
     Qt5::Core
     Qt5::DBus
-    HawaiiQtXDG
     HawaiiSigWatch
     HawaiiQLogind
 )
 
+if(QTXDG_FOUND)
+    target_link_libraries(hawaii-session ${QTXDG_LIBRARIES})
+else()
+    target_link_libraries(hawaii-session HawaiiQtXDG)
+endif()
+
 install(TARGETS hawaii-session DESTINATION ${BIN_INSTALL_DIR})
-- 
1.8.3.1

